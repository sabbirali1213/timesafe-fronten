<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Test - Mutton Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Product Images Test</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="products-grid">
            <div class="text-center text-lg">Loading products...</div>
        </div>
    </div>

    <script>
        // Fetch products from API
        fetch('https://timesafe-payments.preview.emergentagent.com/api/products')
            .then(response => response.json())
            .then(products => {
                const grid = document.getElementById('products-grid');
                grid.innerHTML = '';
                
                products.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-lg shadow-md p-4';
                    
                    let imageHTML = '';
                    if (product.image_url && product.image_url.trim() !== '') {
                        let imageUrl = product.image_url;
                        
                        // Handle different URL formats
                        if (!imageUrl.startsWith('http')) {
                            if (imageUrl.startsWith('/api/uploads/')) {
                                imageUrl = `https://timesafe-payments.preview.emergentagent.com${imageUrl}`;
                            } else if (imageUrl.startsWith('/uploads/')) {
                                imageUrl = `https://timesafe-payments.preview.emergentagent.com/api${imageUrl}`;
                            } else if (!imageUrl.startsWith('data:')) {
                                imageUrl = `https://timesafe-payments.preview.emergentagent.com/api/uploads/${imageUrl}`;
                            }
                        }
                        
                        imageHTML = `
                            <div class="aspect-square bg-gray-200 rounded-lg overflow-hidden mb-4 relative">
                                <img src="${imageUrl}" 
                                     alt="${product.name}" 
                                     class="w-full h-full object-cover"
                                     onload="console.log('‚úì Image loaded successfully:', this.src); this.style.border='3px solid green'"
                                     onerror="console.log('‚úó Image failed to load:', this.src); console.log('Error details:', this); this.parentNode.innerHTML='<div class=\\'flex items-center justify-center h-full text-red-400\\'>‚ùå Load Failed</div>'">>
                                <div class="absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded">Fresh</div>
                                <div class="absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded">IMG</div>
                            </div>
                        `;
                    } else {
                        imageHTML = `
                            <div class="aspect-square bg-gray-200 rounded-lg flex items-center justify-center mb-4">
                                <div class="text-gray-400 text-4xl">üì¶</div>
                            </div>
                        `;
                    }
                    
                    card.innerHTML = `
                        ${imageHTML}
                        <h3 class="font-semibold text-gray-800 mb-2">${product.name}</h3>
                        <p class="text-orange-600 font-bold">‚Çπ${product.price_per_kg}/kg</p>
                        <p class="text-xs text-gray-500 mt-1">Image URL: ${product.image_url || 'None'}</p>
                    `;
                    
                    grid.appendChild(card);
                });
            })
            .catch(error => {
                console.error('Error fetching products:', error);
                document.getElementById('products-grid').innerHTML = 
                    '<div class="text-red-500 text-center">Error loading products</div>';
            });
    </script>
</body>
</html>